âŸ¨ RRTConnect âŸ© â‡ 
âŸ¨ IsValidâŸ© â† â€¢Import "collision.bqn"

 # â‰¢trees = [2, 2, size_of_each_tree]
 # trees is composed of start tree and goal tree.
 # A tree is made of two lists: the list of index of q_list to reference which node we
 # are talking about, and the list of parent of the tree.
RRTConnect â† {
 ğ•© â‹„ s â† âŸ¨0.01, 0.01, 0.01âŸ©  â‹„  g â† âŸ¨0.85, 0.2, 0âŸ©
 trees â† âŸ¨ âŸ¨âŸ¨0âŸ©, âŸ¨0âŸ©âŸ©, âŸ¨âŸ¨1âŸ©,âŸ¨0âŸ©âŸ© âŸ© â‹„ q_list â† âŸ¨s, gâŸ© â‹„ d_max â† 0.01
 
 # n LinSample aâ€¿b will gives [a, a+0.001, a+0.002, (n times), b]
 LinSample â† {nâ†ğ•¨ Ã·Ëœ âŸœ(Â¯1Ã—-Â´)ğ•© â‹„ (1âŠ‘ğ•©)âˆ¾Ëœ â‰ (âŠ‘ğ•©)+ nÃ— (â‰ âŠ‘ğ•©)â€¿ğ•¨ â¥Š (âŠ¢âˆ¾âŠ¢)âŸœâ†• ğ•¨}
 # TODO the TransitionCol function should use the resolution parameter (eps)
 TransitionCol â† âˆ¨Â´âˆ˜(Â¬IsValidË˜) 10Ë™âŠ¸LinSample

 # ğ•©: The node to be compared with, ğ•¨: the specific tree (not the parent tree)
 # Output the index of the nearest node to ğ•© in the tree ğ•¨ (example: k not ğ•¨[k])
 NearestNeighbor â† {âŠ‘(âŠ¢âŠâŒŠÂ´) (ğ•¨âŠq_list) {+Â´Ã—Ëœğ•¨-ğ•©}Â¨ <ğ•© }

 # ğ•©: the node to be added, ğ•¨=(t, p): the index of the tree and the index of the parent
 AddNode â† { tâ€¿pâ†ğ•¨ â‹„ trees âˆ¾âŸœ(â‰ q_list)âŒ¾(âŠ‘(tâŠ¸âŠ‘))â†© â‹„ trees âˆ¾âŸœ(p)âŒ¾(1âŠ‘(tâŠ¸âŠ‘))â†© â‹„ q_list âˆ¾âŸœ(<ğ•©)â†©}

 # ğ•©: the node q we extend toward, the index of the tree considered, the maximum distance
 Extend  â† {
   qâ€¿t: p â† ((âŠ‘tâŠ‘trees) NearestNeighbor q) â‹„ q_near â† (pâŠ‘âŠ‘tâŠ‘ trees) âŠ‘ q_list  
    
   dist â† âˆš (+Â´Ã—Ëœ q - q_near)
   q_new â† (d_maxâ‰¤dist)  âŠ‘ qâ€¿(q_near + distÃ·Ëœd_maxÃ—(q - q_near))
   col â† TransitionCol q_nearâ€¿q_new
   
   { col ? @ ; (tâ€¿p) AddNode q_new}
   colâ€¿(Â¬ d_maxâ‰¤dist)
 }

 # ğ•©: the node q we extend toward, the index of the tree considered
 Connect â† {qâ€¿t: a â† Extend qâ€¿(Â¬t) â‹„ ğ•ŠâŸ(Â¬âˆ¨Â´ a) ğ•© â‹„ 1âŠ‘a}
 
 InnerLoop â† { ğ•© â‹„ t â† (2|n) â‹„ q_rand â† 3 â€¢rand.Range 0
  {Â¬solved ?
    nâ†©n+1 â‹„ solved â†© { Â¬âŠ‘(Extend q_randâ€¿t) ? Connect (âŠ‘Â¯1â†‘q_list)â€¿t ; 0 }
    {solved ? aâ€¿b â† {idxâ€¿p: (p {ğ•©=0 ? ğ•©; ğ•©âˆ¾ (ğ•¨ğ•Š (ğ•©âŠ‘ğ•¨))} Â¯1âŠ‘p) âŠ idx}Â¨ trees
              path_sol â†© ((âŒ½a) âˆ¾ b)âŠq_list ;
	      @ } ;
    @
  } 
 }
 
 n â† 0 â‹„ solved â† 0 â‹„ path_sol â† 0 â‹„ InnerLoopâŸ10000 0 â‹„ solvedâ€¿nâ€¿path_sol
} 

solvedâ€¿iterâ€¿path_sol â† RRTConnect 0
â€¢Show solvedâ€¿iter
J â† âˆ¾1â†“Â·â¥Š<âŠ¸(â‰Ë˜) #Csv util from bqn-crate
"solution.csv" â€¢file.Lines (<",") JÂ¨ â€¢ReprÂ¨Â¨ path_sol
